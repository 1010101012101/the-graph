<link rel="import" href="../the-graph-inports/the-graph-inports.html">
<link rel="import" href="../the-graph-outports/the-graph-outports.html">
<polymer-element name="the-graph-process" attributes="label x y component">

  <template>
    <div class="the-graph-process">
      <h1 title="{{component}}">{{label}}</h1>
      <content select="the-graph-inports"></content>
      <content select="the-graph-outports"></content>
    </div>
  </template>

  <script>

    var translate = function (el, x, y) {
      var move = "translate3d("+x+"px,"+y+"px,0px)";
      // var move = "translate("+x+"px,"+y+"px)";
      el.style.webkitTransform = move;
      el.style.MozTransform = move;
      el.style.msTransform = move;
      el.style.OTransform = move;
      el.style.transform = move;
      return el;
    };

    var debounce = function(func, wait, immediate) {
      var timeout;
      return function() {
        var context = this, args = arguments;
        var later = function() {
          timeout = null;
          if (!immediate) func.apply(context, args);
        };
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
      };
    };

    Polymer('the-graph-process', {
      created: function () {
        this.style.position = 'absolute';
//        translate(this, this.x, this.y);
      },
      label: '',
      x: 0,
      y: 0,
      xChanged: function () {
        console.log("x");
        this.positionChanged();
      },
      yChanged: function () {
        console.log("y");
        this.positionChanged();
      },
      debounceTimeout: null,
      positionChanged: function () {
        var context = this;
        var later = function(){
          context.debounceTimeout = null;
          console.log(Date.now(), context.x, context.y);
          translate(context, context.x, context.y);
          context.fire('moved', {
            x: context.x,
            y: context.y
          });
        }
        clearTimeout(this.debounceTimeout);
        this.debounceTimeout = setTimeout(later, 16);
      }

    });
  </script>
</polymer-element>

