<link rel="import" href="../the-graph-edge/the-graph-edge.html">

<polymer-element name="the-graph-edges" attributes="connections" lightdom>
  <template>
    <svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%">
      <g id="connections" transform="translate(500,500)"></g>
    </svg>
    <template repeat="{{connections}}">
      <the-graph-edge connection="{{}}"></the-graph-edge>
    </template>
  </template>

  <script type="text/javascript" src="../the-graph-util/the-graph-util.js"></script>

  <script>
    Polymer('the-graph-edges', {
      connections: [],
      enteredView: function () {
        var graph = this.parentNode;
        this.graph = graph;
        graph.addEventListener("bumped", function(event){
          this.graphBumped(event.detail);
        }.bind(this));
        this.graphBumped({
          x:graph.padding,
          y:graph.padding
        });
      },
      connectionsChanged: function () {
        this.setGroupForEdges();
      },
      setGroupForEdges: function () {
        var childNodes = Array.prototype.slice.call(this.childNodes);
        childNodes.forEach(function (node) {
          if (node.nodeType !== 'THE-GRAPH-EDGE') {
            return;
          }
          node.group = this.$.connections;
        });
      },
      graphBumped: function (bump) {
        this.$.connections.setAttribute("transform", "translate("+bump.x+","+bump.y+")");
      }
    });
  </script>
  
</polymer-element>
